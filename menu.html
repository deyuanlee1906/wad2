<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Menu Selection</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css" rel="stylesheet"/>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.css" rel="stylesheet" />
  <link rel="stylesheet" href="theme.css" />
  <style>
    body { }
    .order-header-bar {
      display: flex;
      gap: 10px;
      justify-content: space-between;
      margin-bottom: 1rem;
      flex-wrap: wrap;
    }
    .order-header-box {
      background: #fff;
      border: 1.5px solid #bbb;
      border-radius: 17px;
      padding: 8px 16px;
      min-width: 148px;
      min-height: 48px;
      font-size: 15px;
      display: flex;
      align-items: center;
      margin-bottom: 0.25em;
      flex: 1;
    }
    .order-header-box b {
      font-size: 16px;
    }
    .cat-side-nav {
      background: #fff;
      border-right: 1px solid #e0e0e0;
      min-width: 135px;
      max-width: 180px;
      padding: 0;
      height:100%;
    }
    .cat-btn {
      width: 100%;
      padding: 16px 18px;
      border: none;
      border-bottom: 1px solid #e5e5e5;
      background: none;
      text-align: left;
      font-weight: 700;
      font-size: 1.1em;
      color: #333;
      outline: none;
      transition: background 0.15s;
    }
    .cat-btn.selected, .cat-btn:active {
      background: #e0e0e0;
    }
    .food-card {
      background: #fff;
      border: 1px solid #bbb;
      border-radius: 9px;
      display: flex;
      align-items: center;
      padding: 8px 14px 8px 8px;
      margin-bottom: 14px;
      gap: 12px;
    }
    .food-img {
      width: 64px; height: 64px; object-fit: cover; border-radius: 7px; border:1.5px solid #ddd;
      background: #f8f8f8;
    }
    .food-info { flex-grow: 1; }
    .food-title { font-weight: bold; }
    .food-price { color: #5c5c5c; font-size: 0.98em; }
    .food-controls {
      display: flex; align-items: center; gap: 3px;
      min-width: 78px;
    }
    .food-controls .btn { padding:2px 9px; font-size: 1.1em; }
    .trash-btn { color: #c13f3f; font-size: 1.1em; }
    .cart-bar {
      position: fixed;
      bottom: 0; left: 0; right: 0;
      max-width: 500px;
      margin: 0 auto;
      background: #fff !important;
      border-top: 2px solid #f1f1f1;
      box-shadow: 0 -2px 14px rgba(0,0,0,0.04);
      z-index: 31;
    }
    .cart-bar-btn {
      font-weight: 700; font-size: 1.13em;
      border-radius: 22px;
    }
    @media (max-width: 767px) {
      .cat-side-nav {
        min-width: 100px !important; max-width: 34vw !important;
        border-right: 1px solid #efefef;
      }
      .cat-btn, .cat-btn.selected { font-size: 1em; padding: 10px 7px;}
      .cart-bar {
        left:0; right:0;
        border-radius:0 !important;
        bottom: 0;
        max-width: 100vw;
      }
      .container { padding-left: 5px; padding-right: 5px;}
    }
    @media (max-width:400px){
      .order-header-bar { gap: 2vw;}
      .order-header-box { min-width: 120px; padding: 6px 0.6em;}
      .cart-bar { max-width:100vw;}
      .cat-side-nav { min-width:60px !important;}
    }
  </style>
</head>
<body class="theme-gradient">
  <div class="container pb-5" style="max-width: 500px;">
    <!-- Order summary bar -->
    <div class="order-header-bar mt-2 mb-0">
      <div class="order-header-box d-flex align-items-center flex-grow-1 gap-2">
        <span><svg width="18" height="18" fill="gray" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path d="M8 16s6-5.686 6-10A6 6 0 1 0 2 6c0 4.314 6 10 6 10Zm0-8a2 2 0 1 1 0-4 2 2 0 0 1 0 4Z"/></svg></span>
        <span>
          <div style="font-size:12px;"><span id="orderOption"></span></div>
          <b id="orderStall">Stall A</b>
        </span>
      </div>
      <div class="order-header-box d-flex align-items-center gap-2 flex-grow-1 justify-content-end">
        <span><svg width="18" height="18" fill="gray" viewBox="0 0 16 16"><path d="M8 3.5a.5.5 0 0 1 .5.5v4h3a.5.5 0 0 1 0 1H8a.5.5 0 0 1-.5-.5V4a.5.5 0 0 1 .5-.5z"/><path d="M8 16A8 8 0 1 1 8 0a8 8 0 0 1 0 16zM8 1a7 7 0 1 0 0 14A7 7 0 0 0 8 1z"/></svg></span>
        <span id="orderTime">22 Sep 12:00</span>
      </div>
    </div>
    <div class="row gx-0">
      <!-- Categories navigation -->
      <div class="col-md-3 col-4 cat-side-nav d-flex flex-column p-0 mb-1">
        <div id="categoryList"></div>
      </div>
      <!-- Food list -->
      <div class="col-md-9 col-8 px-md-4 px-1">
        <div id="foodSections" class="pt-2"></div>
      </div>
    </div>
  </div>
  <!-- Cart bar -->
  <div class="cart-bar shadow-sm py-2 px-3 d-flex justify-content-between align-items-center gap-2">
    <button id="viewCartBtn" class="btn btn-outline-primary cart-bar-btn flex-grow-1">View my cart</button>
    <span class="fw-bold fs-5" id="cartTotal">$0.00</span>
  </div>

  <script>
    // URL params and state
    const urlParams = new URLSearchParams(window.location.search);
    const orderOptionParam = urlParams.get('option') || '';
    const orderStall = urlParams.get('stall') || 'Stall A';
    const orderTimeParam = urlParams.get('time') || '22 Sep 12:00';

    // Determine selected option: prefer a value set from stall.html via localStorage, then URL param, then default
    const storedOption = localStorage.getItem('selectedOption'); // stall.html can set this key
    const orderOption = storedOption || orderOptionParam || 'Dine In';
    document.getElementById('orderStall').textContent = orderStall;
    document.getElementById('orderOption').textContent = orderOption;

    // If user selected "ASAP" (case-insensitive), hide the time display; otherwise show the provided time
    const timeEl = document.getElementById('orderTime');
    if (orderTimeParam && orderTimeParam.toLowerCase() === 'asap') {
      // hide the time box entirely
      const timeBox = timeEl.closest('.order-header-box');
      if (timeBox) timeBox.style.display = 'none';
    } else {
      timeEl.textContent = orderTimeParam;
      // ensure it's visible in case it was previously hidden
      const timeBox = timeEl.closest('.order-header-box');
      if (timeBox) timeBox.style.display = '';
    }
  </script>
  <script>
    // Data setup
    const categories = [
      { name: "Category 1" }, { name: "Category 2" }, { name: "Category 3" }, { name: "Category 4" }
    ];
    const foodsPerCategory = [
      [
        { name: "Chicken Rice", price: 4, img: "img/stall1.jpg", id: "cr" },
        { name: "Roast Duck Rice", price: 5, img: "img/stall2.jpg", id: "rd" },
        { name: "Steamed Fish", price: 7, img: "img/stall3.jpg", id: "sf" }
      ],
      [
        { name: "Laksa", price: 4.5, img: "img/stall1.jpg", id: "lk" }
      ],
      [],
      []
    ];
    let selectedCatIdx = 0;
    let cart = {};

    // Side nav/category
    function renderCategoryBar() {
      let html = "";
      categories.forEach((cat, idx) => {
        html += `<button class="cat-btn${idx===selectedCatIdx ? ' selected':''}" onclick="scrollToCategory(${idx})">${cat.name}</button>`;
      });
      document.getElementById('categoryList').innerHTML = html;
    }

    // Food item sections/cards
    function renderFoodSections() {
      let html = "";
      categories.forEach((cat, idx) => {
        html += `<div class="section" id="catSection${idx}">
          <div class="category-header mb-2">${cat.name}</div>
          ${
            foodsPerCategory[idx].length === 0
            ? '<div class="text-muted mb-3">No food in this category.</div>'
            : foodsPerCategory[idx].map(food => {
                const qty = cart[food.id] || 0;
                return `
                  <div class="food-card">
                    <img src="${food.img}" alt="Food" class="food-img"/>
                    <div class="food-info">
                      <div class="food-title">${food.name}</div>
                      <div class="food-price">Price: $${food.price.toFixed(2)}</div>
                    </div>
                    <div class="food-controls">
                      ${qty === 0
                        ? `<button type="button" class="btn btn-outline-primary btn-sm" onclick="addToCart('${food.id}')">+</button>`
                        : qty === 1
                          ? `<button type="button" class="btn btn-outline-danger p-1 me-1 trash-btn" title="Remove" onclick="removeFromCart('${food.id}')"><svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" fill="currentColor" viewBox="0 0 16 16"><path d="M5.5 5.5a.5.5 0 0 0-.5.5v5.5a.5.5 0 0 0 .5.5H6a.5.5 0 0 0 .5-.5V6a.5.5 0 0 0-.5-.5H5.5z"/></svg></button>
                            <span>1</span>`
                          : `<button type="button" class="btn btn-outline-secondary btn-sm me-1" onclick="removeFromCart('${food.id}')">-</button>
                             <span>${qty}</span>`
                      }
                      ${qty > 0
                        ? `<button type="button" class="btn btn-outline-primary btn-sm ms-1" onclick="addToCart('${food.id}')">+</button>`
                        : ""
                      }
                    </div>
                  </div>
                `;
              }).join('')
          }
        </div>`;
      });
      document.getElementById('foodSections').innerHTML = html;
    }

    // Scroll and sync
    function scrollToCategory(idx) {
      const section = document.getElementById('catSection' + idx);
      if (section) section.scrollIntoView({ behavior: 'smooth' });
    }
    window.scrollToCategory = scrollToCategory;

    function updateCategoryOnScroll() {
      let sections = categories.map((_, idx) => document.getElementById('catSection' + idx));
      let scrollPos = window.pageYOffset || document.documentElement.scrollTop;
      let activeIdx = 0;
      for (let i = sections.length - 1; i >= 0; i--) {
        if (sections[i]) {
          let rect = sections[i].getBoundingClientRect();
          let offset = rect.top + window.pageYOffset - 90;
          if (scrollPos >= offset) {
            activeIdx = i;
            break;
          }
        }
      }
      if (activeIdx !== selectedCatIdx) {
        selectedCatIdx = activeIdx;
        renderCategoryBar();
      }
    }
    window.addEventListener('scroll', updateCategoryOnScroll);

    window.addToCart = function(fid) {
      cart[fid] = (cart[fid] || 0) + 1;
      renderFoodSections();
      renderCategoryBar();
      updateCartBar();
    };
    window.removeFromCart = function(fid) {
      if (cart[fid]) cart[fid]--;
      if (cart[fid] <= 0) delete cart[fid];
      renderFoodSections();
      renderCategoryBar();
      updateCartBar();
    };

    function updateCartBar() {
      let total = 0;
      Object.keys(cart).forEach(fid => {
        for (let arr of foodsPerCategory) {
          const found = arr.find(x => x.id === fid);
          if (found) total += found.price * cart[fid];
        }
      });
      document.getElementById('cartTotal').textContent = '$' + total.toFixed(2);
    }

    // View cart button => go to checkout
    document.getElementById('viewCartBtn').onclick = function() {
      window.location.href = "checkout.html";
    };

    renderFoodSections();
    renderCategoryBar();
    updateCartBar();
  </script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/js/bootstrap.bundle.min.js"></script>

  <div class="nav-bar">
    <button class="active" onclick="location.href='online-order-home.html'">
      <i class="bi bi-cart3"></i>
      <span>Order</span>
    </button>
    <button onclick="location.href='community.html'">
      <i class="bi bi-people"></i>
      <span>Community</span>
    </button>
    <button onclick="location.href='chope-home.html'">
      <i class="bi bi-bookmark"></i>
      <span>Chope</span>
    </button>
    <button onclick="location.href='crowd-view.html'">
      <i class="bi bi-eye"></i>
      <span>Crowd View</span>
    </button>
    <button onclick="location.href='profile.html'">
      <i class="bi bi-person"></i>
      <span>Profile</span>
    </button>
  </div>
</body>
</html>
