<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Seats Availability</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet"/>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.css" rel="stylesheet"/>
  <link rel="stylesheet" href="/styles/main.css">
  <link rel="stylesheet" href="/styles/components.css">
</head>
<body class="theme-gradient">
  <div class="container-fluid my-4">
    <h2 class="mb-3 text-center">Available Food Centers</h2>

    <p class="text-center" id="info"></p>
    <div class="row" id="centers"></div>

    <div class="text-center mt-4">
      <a href="chope.html" class="btn btn-outline-secondary">Back to Home</a>
    </div>
  </div>

  <script>
    // Read from URL first
    const params = new URLSearchParams(window.location.search);
    let time = params.get("time");
    let duration = params.get("duration");

    // Fallback to sessionStorage if URL lacks params
    if (time === null || duration === null) {
      time = sessionStorage.getItem("time");
      duration = sessionStorage.getItem("duration");
    }

    // Demo data (localStorage-backed)
    let centers = JSON.parse(localStorage.getItem("centers")) || [
      { id: 1, name: "Maxwell Food Centre", img: "maxwell.jpg",        seats: 20, booked: 8,  link: "maxwell.html" },
      { id: 2, name: "Newton Food Centre",  img: "newton.jpg",         seats: 20, booked: 4,  link: "newton.html"  },
      { id: 3, name: "Changi Village",      img: "changi_village.jpg", seats: 30, booked: 10, link: "changiVillage.html" }
    ];

    function printCenters() {
      const container = document.getElementById("centers");
      container.innerHTML = "";

      for (const center of centers) {
        const available = center.seats - center.booked;

        const col = document.createElement("div");
        col.className = "col-12 col-md-4 mb-3";

        const card = document.createElement("div");
        card.className = "card shadow-sm h-100";

        const img = document.createElement("img");
        img.src = "/../../" + center.img; // adjust if your paths differ
        img.alt = center.name;
        img.className = "card-img-top";
        img.style.objectFit = "cover";
        img.style.height = "180px";

        const body = document.createElement("div");
        body.className = "card-body d-flex flex-column";

        const title = document.createElement("h5");
        title.className = "card-title";
        title.textContent = center.name;

        const seatsAvail = document.createElement("p");
        seatsAvail.className = "mb-2";
        const color = available > 0 ? "#D98566" : "#262626";
        seatsAvail.innerHTML = `Available seats: <strong style="color:${color}">${available}</strong>`;

        const selTime = document.createElement("p");
        selTime.className = "text-muted small mb-3";
        selTime.textContent = `Selected Time: ${time ?? "(none)"} • Duration: ${duration ?? "(none)"}`;

        const btn = document.createElement("button");
        btn.className = "btn btn-primary mt-auto";
        btn.type = "button";
        btn.textContent = available > 0 ? "Book Now" : "Full";
        if (available <= 0) btn.disabled = true;

        btn.addEventListener("click", () => bookSeat(center.id));

        body.appendChild(title);
        body.appendChild(seatsAvail);
        body.appendChild(selTime);
        body.appendChild(btn);

        card.appendChild(img);
        card.appendChild(body);
        col.appendChild(card);
        container.appendChild(col);
      }
    }

    function bookSeat(id) {
      for (const center of centers) {
        if (center.id === id) {
          if (center.booked < center.seats) {
            center.booked++;
            localStorage.setItem("centers", JSON.stringify(centers));
            alert(`✅ Seat booked at ${center.name} for ${time || "(unknown time)"}!`);
            window.location.href = center.link; // carry params if needed
          } else {
            alert("No seats left!");
          }
          return;
        }
      }
    }

    printCenters();
  </script>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/js/bootstrap.bundle.min.js" crossorigin="anonymous"></script>

    <div class="nav-bar">
        <button onclick="location.href='/pages/order/online-order-home.html'">
            <i class="bi bi-cart3"></i>
            <span>Order</span>
        </button>
        <button onclick="location.href='/pages/community/community.html'">
            <i class="bi bi-people"></i>
            <span>Community</span>
        </button>
        <button onclick="location.href='/pages/chope/chope.html'">
            <i class="bi bi-bookmark"></i>
            <span>Chope</span>
        </button>
        <button onclick="location.href='/pages/crowd/crowd-view.html'">
            <i class="bi bi-eye"></i>
            <span>Crowd View</span>
        </button>
        <button onclick="location.href='/pages/profile/profile.html'">
            <i class="bi bi-person"></i>
            <span>Profile</span>
        </button>
    </div>
</body>
</html>
