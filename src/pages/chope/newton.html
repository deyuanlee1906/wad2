<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Newton Food Center</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-sRIl4kxILFvY47J16cr9ZwB07vP4J8+LH7qKQnuqkuIAvNWLzeN8tE5YBujZqJLB" crossorigin="anonymous">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.css" rel="stylesheet">
    <link rel="stylesheet" href="../theme.css">
    <link rel="stylesheet" href="../style-1.css">
    <script src="seatDatabase.js"></script>
</head>
<body class="theme-gradient">
    <div class="container-fluid px-3">
        <!-- Header with back button -->
        <div class="d-flex align-items-center mb-3">
            <button class="btn btn-outline-secondary me-3" onclick="history.back()">
                <i class="bi bi-arrow-left"></i>
            </button>
            <h2 class="mb-0">MAPS</h2>
        </div>

        <!-- Tabs -->
        <div class="d-flex border-bottom mb-4">
            <button class="btn btn-link px-4 py-2 border-bottom border-primary border-2 text-decoration-none fw-bold" id="seatPlanTab">
                SEAT PLAN
            </button>
        </div>

        <!-- Location title -->
        <h5 class="mb-3">Newton Food Centre</h5>

        <!-- Legend -->
        <div class="d-flex align-items-center mb-4">
            <div class="d-flex align-items-center me-4">
                <div class="legend-box booked-color me-2"></div>
                <span>Booked</span>
            </div>
            <div class="d-flex align-items-center me-4">
                <div class="legend-box available-color me-2"></div>
                <span>Available</span>
            </div>
            <div class="d-flex align-items-center">
                <div class="legend-box hawker-color me-2"></div>
                <span>Hawker</span>
            </div>
        </div>

        <!-- SVG Floor Plan Container -->
        <div class="floor-plan-container">
            <svg id="floorPlan" viewBox="0 0 800 600" class="w-100">
                <!-- Row 1: 3 Tables (10 seats each) -->
                <!-- Table 1 -->
                <rect x="50" y="50" width="100" height="140" fill="#F2D9BB" stroke="#D98566" stroke-width="2" rx="8"/>
                <text x="100" y="130" text-anchor="middle" class="table-label">Table 1</text>
                
                <!-- Table 1 Seats - Left side (5 seats) -->
                <circle cx="30" cy="70" r="8" fill="#28a745" class="seat clickable" data-table="1" data-seat="1" data-status="available"/>
                <text x="30" y="74" text-anchor="middle" class="seat-number">1</text>
                <circle cx="30" cy="90" r="8" fill="#28a745" class="seat clickable" data-table="1" data-seat="2" data-status="available"/>
                <text x="30" y="94" text-anchor="middle" class="seat-number">2</text>
                <circle cx="30" cy="110" r="8" fill="#28a745" class="seat clickable" data-table="1" data-seat="3" data-status="available"/>
                <text x="30" y="114" text-anchor="middle" class="seat-number">3</text>
                <circle cx="30" cy="130" r="8" fill="#28a745" class="seat clickable" data-table="1" data-seat="4" data-status="available"/>
                <text x="30" y="134" text-anchor="middle" class="seat-number">4</text>
                <circle cx="30" cy="150" r="8" fill="#28a745" class="seat clickable" data-table="1" data-seat="5" data-status="available"/>
                <text x="30" y="154" text-anchor="middle" class="seat-number">5</text>
                
                <!-- Table 1 Seats - Right side (5 seats) -->
                <circle cx="170" cy="70" r="8" fill="#28a745" class="seat clickable" data-table="1" data-seat="6" data-status="available"/>
                <text x="170" y="74" text-anchor="middle" class="seat-number">6</text>
                <circle cx="170" cy="90" r="8" fill="#28a745" class="seat clickable" data-table="1" data-seat="7" data-status="available"/>
                <text x="170" y="94" text-anchor="middle" class="seat-number">7</text>
                <circle cx="170" cy="110" r="8" fill="#28a745" class="seat clickable" data-table="1" data-seat="8" data-status="available"/>
                <text x="170" y="114" text-anchor="middle" class="seat-number">8</text>
                <circle cx="170" cy="130" r="8" fill="#28a745" class="seat clickable" data-table="1" data-seat="9" data-status="available"/>
                <text x="170" y="134" text-anchor="middle" class="seat-number">9</text>
                <circle cx="170" cy="150" r="8" fill="#28a745" class="seat clickable" data-table="1" data-seat="10" data-status="available"/>
                <text x="170" y="154" text-anchor="middle" class="seat-number">10</text>

                <!-- Table 2 -->
                <rect x="220" y="50" width="100" height="140" fill="#F2D9BB" stroke="#D98566" stroke-width="2" rx="8"/>
                <text x="270" y="130" text-anchor="middle" class="table-label">Table 2</text>
                
                <!-- Table 2 Seats - Left side (5 seats) -->
                <circle cx="200" cy="70" r="8" fill="#28a745" class="seat clickable" data-table="2" data-seat="1" data-status="available"/>
                <text x="200" y="74" text-anchor="middle" class="seat-number">1</text>
                <circle cx="200" cy="90" r="8" fill="#28a745" class="seat clickable" data-table="2" data-seat="2" data-status="available"/>
                <text x="200" y="94" text-anchor="middle" class="seat-number">2</text>
                <circle cx="200" cy="110" r="8" fill="#28a745" class="seat clickable" data-table="2" data-seat="3" data-status="available"/>
                <text x="200" y="114" text-anchor="middle" class="seat-number">3</text>
                <circle cx="200" cy="130" r="8" fill="#28a745" class="seat clickable" data-table="2" data-seat="4" data-status="available"/>
                <text x="200" y="134" text-anchor="middle" class="seat-number">4</text>
                <circle cx="200" cy="150" r="8" fill="#28a745" class="seat clickable" data-table="2" data-seat="5" data-status="available"/>
                <text x="200" y="154" text-anchor="middle" class="seat-number">5</text>
                
                <!-- Table 2 Seats - Right side (5 seats) -->
                <circle cx="340" cy="70" r="8" fill="#28a745" class="seat clickable" data-table="2" data-seat="6" data-status="available"/>
                <text x="340" y="74" text-anchor="middle" class="seat-number">6</text>
                <circle cx="340" cy="90" r="8" fill="#28a745" class="seat clickable" data-table="2" data-seat="7" data-status="available"/>
                <text x="340" y="94" text-anchor="middle" class="seat-number">7</text>
                <circle cx="340" cy="110" r="8" fill="#28a745" class="seat clickable" data-table="2" data-seat="8" data-status="available"/>
                <text x="340" y="114" text-anchor="middle" class="seat-number">8</text>
                <circle cx="340" cy="130" r="8" fill="#28a745" class="seat clickable" data-table="2" data-seat="9" data-status="available"/>
                <text x="340" y="134" text-anchor="middle" class="seat-number">9</text>
                <circle cx="340" cy="150" r="8" fill="#28a745" class="seat clickable" data-table="2" data-seat="10" data-status="available"/>
                <text x="340" y="154" text-anchor="middle" class="seat-number">10</text>

                <!-- Table 3 -->
                <rect x="390" y="50" width="100" height="140" fill="#F2D9BB" stroke="#D98566" stroke-width="2" rx="8"/>
                <text x="440" y="130" text-anchor="middle" class="table-label">Table 3</text>
                
                <!-- Table 3 Seats - Left side (5 seats) -->
                <circle cx="370" cy="70" r="8" fill="#28a745" class="seat clickable" data-table="3" data-seat="1" data-status="available"/>
                <text x="370" y="74" text-anchor="middle" class="seat-number">1</text>
                <circle cx="370" cy="90" r="8" fill="#28a745" class="seat clickable" data-table="3" data-seat="2" data-status="available"/>
                <text x="370" y="94" text-anchor="middle" class="seat-number">2</text>
                <circle cx="370" cy="110" r="8" fill="#28a745" class="seat clickable" data-table="3" data-seat="3" data-status="available"/>
                <text x="370" y="114" text-anchor="middle" class="seat-number">3</text>
                <circle cx="370" cy="130" r="8" fill="#28a745" class="seat clickable" data-table="3" data-seat="4" data-status="available"/>
                <text x="370" y="134" text-anchor="middle" class="seat-number">4</text>
                <circle cx="370" cy="150" r="8" fill="#28a745" class="seat clickable" data-table="3" data-seat="5" data-status="available"/>
                <text x="370" y="154" text-anchor="middle" class="seat-number">5</text>
                
                <!-- Table 3 Seats - Right side (5 seats) -->
                <circle cx="510" cy="70" r="8" fill="#28a745" class="seat clickable" data-table="3" data-seat="6" data-status="available"/>
                <text x="510" y="74" text-anchor="middle" class="seat-number">6</text>
                <circle cx="510" cy="90" r="8" fill="#28a745" class="seat clickable" data-table="3" data-seat="7" data-status="available"/>
                <text x="510" y="94" text-anchor="middle" class="seat-number">7</text>
                <circle cx="510" cy="110" r="8" fill="#28a745" class="seat clickable" data-table="3" data-seat="8" data-status="available"/>
                <text x="510" y="114" text-anchor="middle" class="seat-number">8</text>
                <circle cx="510" cy="130" r="8" fill="#28a745" class="seat clickable" data-table="3" data-seat="9" data-status="available"/>
                <text x="510" y="134" text-anchor="middle" class="seat-number">9</text>
                <circle cx="510" cy="150" r="8" fill="#28a745" class="seat clickable" data-table="3" data-seat="10" data-status="available"/>
                <text x="510" y="154" text-anchor="middle" class="seat-number">10</text>

                <!-- Row 2: 4 Stores (back to back) -->
                <rect x="50" y="220" width="90" height="50" fill="#D98566" stroke="#262626" stroke-width="1" rx="5"/>
                <text x="95" y="250" text-anchor="middle" class="stall-label">Stall 1</text>
                
                <rect x="150" y="220" width="90" height="50" fill="#D98566" stroke="#262626" stroke-width="1" rx="5"/>
                <text x="195" y="250" text-anchor="middle" class="stall-label">Stall 2</text>
                
                <rect x="250" y="220" width="90" height="50" fill="#D98566" stroke="#262626" stroke-width="1" rx="5"/>
                <text x="295" y="250" text-anchor="middle" class="stall-label">Stall 3</text>
                
                <rect x="350" y="220" width="90" height="50" fill="#D98566" stroke="#262626" stroke-width="1" rx="5"/>
                <text x="395" y="250" text-anchor="middle" class="stall-label">Stall 4</text>

                <!-- Row 3: 2 Tables (10 seats each) -->
                <!-- Table 4 -->
                <rect x="50" y="320" width="100" height="140" fill="#F2D9BB" stroke="#D98566" stroke-width="2" rx="8"/>
                <text x="100" y="400" text-anchor="middle" class="table-label">Table 4</text>
                
                <!-- Table 4 Seats - Left side (5 seats) -->
                <circle cx="30" cy="340" r="8" fill="#28a745" class="seat clickable" data-table="4" data-seat="1" data-status="available"/>
                <text x="30" y="344" text-anchor="middle" class="seat-number">1</text>
                <circle cx="30" cy="360" r="8" fill="#28a745" class="seat clickable" data-table="4" data-seat="2" data-status="available"/>
                <text x="30" y="364" text-anchor="middle" class="seat-number">2</text>
                <circle cx="30" cy="380" r="8" fill="#28a745" class="seat clickable" data-table="4" data-seat="3" data-status="available"/>
                <text x="30" y="384" text-anchor="middle" class="seat-number">3</text>
                <circle cx="30" cy="400" r="8" fill="#28a745" class="seat clickable" data-table="4" data-seat="4" data-status="available"/>
                <text x="30" y="404" text-anchor="middle" class="seat-number">4</text>
                <circle cx="30" cy="420" r="8" fill="#28a745" class="seat clickable" data-table="4" data-seat="5" data-status="available"/>
                <text x="30" y="424" text-anchor="middle" class="seat-number">5</text>
                
                <!-- Table 4 Seats - Right side (5 seats) -->
                <circle cx="170" cy="340" r="8" fill="#28a745" class="seat clickable" data-table="4" data-seat="6" data-status="available"/>
                <text x="170" y="344" text-anchor="middle" class="seat-number">6</text>
                <circle cx="170" cy="360" r="8" fill="#28a745" class="seat clickable" data-table="4" data-seat="7" data-status="available"/>
                <text x="170" y="364" text-anchor="middle" class="seat-number">7</text>
                <circle cx="170" cy="380" r="8" fill="#28a745" class="seat clickable" data-table="4" data-seat="8" data-status="available"/>
                <text x="170" y="384" text-anchor="middle" class="seat-number">8</text>
                <circle cx="170" cy="400" r="8" fill="#28a745" class="seat clickable" data-table="4" data-seat="9" data-status="available"/>
                <text x="170" y="404" text-anchor="middle" class="seat-number">9</text>
                <circle cx="170" cy="420" r="8" fill="#28a745" class="seat clickable" data-table="4" data-seat="10" data-status="available"/>
                <text x="170" y="424" text-anchor="middle" class="seat-number">10</text>

                <!-- Table 5 -->
                <rect x="220" y="320" width="100" height="140" fill="#F2D9BB" stroke="#D98566" stroke-width="2" rx="8"/>
                <text x="270" y="400" text-anchor="middle" class="table-label">Table 5</text>
                
                <!-- Table 5 Seats - Left side (5 seats) -->
                <circle cx="200" cy="340" r="8" fill="#28a745" class="seat clickable" data-table="5" data-seat="1" data-status="available"/>
                <text x="200" y="344" text-anchor="middle" class="seat-number">1</text>
                <circle cx="200" cy="360" r="8" fill="#28a745" class="seat clickable" data-table="5" data-seat="2" data-status="available"/>
                <text x="200" y="364" text-anchor="middle" class="seat-number">2</text>
                <circle cx="200" cy="380" r="8" fill="#28a745" class="seat clickable" data-table="5" data-seat="3" data-status="available"/>
                <text x="200" y="384" text-anchor="middle" class="seat-number">3</text>
                <circle cx="200" cy="400" r="8" fill="#28a745" class="seat clickable" data-table="5" data-seat="4" data-status="available"/>
                <text x="200" y="404" text-anchor="middle" class="seat-number">4</text>
                <circle cx="200" cy="420" r="8" fill="#28a745" class="seat clickable" data-table="5" data-seat="5" data-status="available"/>
                <text x="200" y="424" text-anchor="middle" class="seat-number">5</text>
                
                <!-- Table 5 Seats - Right side (5 seats) -->
                <circle cx="340" cy="340" r="8" fill="#28a745" class="seat clickable" data-table="5" data-seat="6" data-status="available"/>
                <text x="340" y="344" text-anchor="middle" class="seat-number">6</text>
                <circle cx="340" cy="360" r="8" fill="#28a745" class="seat clickable" data-table="5" data-seat="7" data-status="available"/>
                <text x="340" y="364" text-anchor="middle" class="seat-number">7</text>
                <circle cx="340" cy="380" r="8" fill="#28a745" class="seat clickable" data-table="5" data-seat="8" data-status="available"/>
                <text x="340" y="384" text-anchor="middle" class="seat-number">8</text>
                <circle cx="340" cy="400" r="8" fill="#28a745" class="seat clickable" data-table="5" data-seat="9" data-status="available"/>
                <text x="340" y="404" text-anchor="middle" class="seat-number">9</text>
                <circle cx="340" cy="420" r="8" fill="#28a745" class="seat clickable" data-table="5" data-seat="10" data-status="available"/>
                <text x="340" y="424" text-anchor="middle" class="seat-number">10</text>
            </svg>
        </div>

        <!-- Instructions -->
        <p class="text-center text-muted mt-3">Click on available seats to book them!</p>
    </div>

    <!-- Booking Modal -->
    <div class="modal fade" id="bookingModal" tabindex="-1" aria-labelledby="bookingModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content custom-modal">
                <div class="modal-header custom-modal-header">
                    <h5 class="modal-title" id="bookingModalLabel">Book Seat</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <p id="seatInfo"></p>
                    <p class="text-muted">Confirm your seat booking?</p>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary custom-btn" id="confirmBooking">Book Now</button>
                </div>
            </div>
        </div>
    </div>

    <style>
        /* Custom Color Theme */
        :root {
            --primary-color: #D98566;
            --secondary-color: #F2D9BB;
            --background-color: #F2F2F2;
            --text-color: #262626;
        }

        body {
            background-color: var(--background-color);
        }

        .legend-box {
            width: 12px;
            height: 12px;
            border-radius: 2px;
        }
        
        .booked-color {
            background-color: #dc3545;
        }
        
        .available-color {
            background-color: #28a745;
        }
        
        .hawker-color {
            background-color: var(--primary-color);
        }
        
        .floor-plan-container {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
            margin-bottom: 20px;
            max-width: 800px;
            margin-left: auto;
            margin-right: auto;
        }
        
        .seat {
            cursor: pointer;
            transition: all 0.15s ease;
            filter: drop-shadow(0 2px 4px rgba(0,0,0,0.1));
        }
        
        .seat.clickable:hover {
            stroke: var(--text-color);
            stroke-width: 3;
            filter: drop-shadow(0 4px 8px rgba(0,0,0,0.2));
        }
        
        .seat.booked {
            cursor: not-allowed;
            opacity: 0.7;
        }
        
        .table-label, .stall-label {
            font-size: 12px;
            font-weight: bold;
            fill: var(--text-color);
        }
        
        .seat-number {
            font-size: 8px;
            font-weight: bold;
            fill: white;
            pointer-events: none;
        }
        
        #seatPlanTab {
            color: var(--primary-color) !important;
            border-bottom-color: var(--primary-color) !important;
        }
        

        /* Modal Styling */
        .custom-modal {
            border-radius: 15px;
            border: none;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }

        .custom-modal-header {
            background-color: var(--secondary-color);
            border-bottom: 2px solid var(--primary-color);
            border-radius: 15px 15px 0 0;
        }

        .custom-btn {
            background-color: var(--primary-color);
            border-color: var(--primary-color);
            border-radius: 8px;
            padding: 8px 20px;
            font-weight: 600;
        }

        .custom-btn:hover {
            background-color: var(--text-color);
            border-color: var(--text-color);
        }

        /* Responsive Design */
        @media (min-width: 768px) {
            .floor-plan-container {
                max-width: 900px;
            }
        }

        @media (max-width: 767px) {
            .floor-plan-container {
                padding: 15px;
                margin: 0 10px 20px 10px;
            }
            
            .legend-box {
                width: 10px;
                height: 10px;
            }
        }
    </style>

    <script>
        let selectedSeat = null;
        let bookingModal = null;

        // Seat booking functionality
        document.addEventListener('DOMContentLoaded', function() {
            const seats = document.querySelectorAll('.seat');
            bookingModal = new bootstrap.Modal(document.getElementById('bookingModal'));
            
            // Load seat status from database
            loadSeatStatus();
            
            seats.forEach(seat => {
                seat.addEventListener('click', function() {
                    const status = this.getAttribute('data-status');
                    const table = this.getAttribute('data-table');
                    const seatNum = this.getAttribute('data-seat');
                    
                    if (status === 'available') {
                        selectedSeat = {
                            element: this,
                            table: table,
                            seat: seatNum,
                            status: status
                        };
                        
                        // Show booking modal
                        document.getElementById('seatInfo').textContent = 
                            `Table ${table}, Seat ${seatNum} - Newton Food Centre`;
                        bookingModal.show();
                    } else if (status === 'booked') {
                        alert('This seat is already booked!');
                    }
                });
            });
            
            // Confirm booking button
            document.getElementById('confirmBooking').addEventListener('click', function() {
                if (selectedSeat) {
                    // Get duration from URL parameters
                    const params = new URLSearchParams(window.location.search);
                    const duration = params.get("duration") || "1 hour";
                    const durationMinutes = duration.includes('hour') ? 
                        parseInt(duration) * 60 : parseInt(duration);
                    
                    // Book the seat in database
                    const success = window.seatDatabase.bookSeat('newton', selectedSeat.table, selectedSeat.seat, durationMinutes);
                    
                    if (success) {
                        // Update visual status
                        selectedSeat.element.setAttribute('data-status', 'booked');
                        selectedSeat.element.setAttribute('fill', '#dc3545');
                        selectedSeat.element.classList.remove('clickable');
                        selectedSeat.element.classList.add('booked');
                        
                        // Close modal
                        bookingModal.hide();
                        
                        // Redirect to confirmation page
                        const time = params.get("time") || "12:00 PM";
                        
                        const confirmationUrl = `booking-confirmation.html?foodCenter=Newton Food Centre&table=${selectedSeat.table}&seat=${selectedSeat.seat}&time=${encodeURIComponent(time)}&duration=${encodeURIComponent(duration)}`;
                        window.location.href = confirmationUrl;
                    } else {
                        alert('Failed to book seat. Please try again.');
                    }
                }
            });
            
            // Tab functionality
            document.getElementById('seatPlanTab').addEventListener('click', function() {
                this.classList.add('border-primary', 'border-bottom', 'border-2', 'fw-bold');
                this.classList.remove('text-muted');
            });
            
        });
        
        function loadSeatStatus() {
            // Load seat status from database
            const seats = document.querySelectorAll('.seat');
            seats.forEach(seat => {
                const table = seat.getAttribute('data-table');
                const seatNum = seat.getAttribute('data-seat');
                
                const status = window.seatDatabase.getSeatStatus('newton', table, seatNum);
                
                if (status === 'booked') {
                    seat.setAttribute('data-status', 'booked');
                    seat.setAttribute('fill', '#dc3545');
                    seat.classList.remove('clickable');
                    seat.classList.add('booked');
                } else {
                    seat.setAttribute('data-status', 'available');
                    seat.setAttribute('fill', '#28a745');
                    seat.classList.add('clickable');
                    seat.classList.remove('booked');
                }
            });
        }
        
        // Refresh seat status every 30 seconds
        setInterval(loadSeatStatus, 30000);
    </script>

    <!-------------------------Bootstrap------------------------- -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-FKyoEForCGlyvwx9Hj09JcYn3nv7wiPVlz7YYwJrWVcXK/BmnVDxM+D2scQbITxI"
        crossorigin="anonymous"></script>

    <div class="nav-bar">
      <button onclick="location.href='../order/online-order-home.html'">
        <i class="bi bi-cart3"></i>
        <span>Order</span>
      </button>
      <button onclick="location.href='../community/community.html'">
        <i class="bi bi-people"></i>
        <span>Community</span>
      </button>
      <button class="active" onclick="location.href='../chope-home.html'">
        <i class="bi bi-bookmark"></i>
        <span>Chope</span>
      </button>
      <button onclick="location.href='../crowd/crowd-view.html'">
        <i class="bi bi-eye"></i>
        <span>Crowd View</span>
      </button>
      <button onclick="location.href='../profile.html'">
        <i class="bi bi-person"></i>
        <span>Profile</span>
      </button>
    </div>
</body>
</html>