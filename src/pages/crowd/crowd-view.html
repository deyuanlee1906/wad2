<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Crowd Levels</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" />
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.css" rel="stylesheet" />
  <link rel="stylesheet" href="/styles/main.css" />
  <link rel="stylesheet" href="/styles/components.css" />
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    .dropdown {
      display: flex;
      flex-direction: column;
      gap: 6px;
      width: 100%;
    }

    .dropdown label {
      font-weight: 600;
      color: #262626;
    }

    .dropdown select {
      width: 100%;
      padding: 10px;
      border: 2px solid #F2C6B6;
      border-radius: 8px;
      background-color: #F2F2F2;
      color: #262626;
      font-size: 14px;
      transition: all 0.3s ease;
      outline: none;
    }

    .dropdown select:hover {
      border-color: #D98566;
      background-color: #ffffff;
    }

    .dropdown select:focus {
      border-color: #C9784F;
      background-color: #ffffff;
      box-shadow: 0 0 0 3px rgba(201, 120, 79, 0.1);
    }

    .hawker-info-box {
      margin: 15px 0;
      padding: 15px;
      background-color: #F2D9BB;
      border: 2px solid #F2C6B6;
      border-radius: 10px;
      transition: all 0.2s ease;
    }

    .hawker-info-box:hover {
      border-color: #D98566;
      box-shadow: 0 2px 8px rgba(217, 133, 102, 0.1);
    }

    .hawker-info-box strong {
      color: #1a1a1a;
    }

    .hawker-info-box div {
      color: #262626;
    }
  </style>
</head>
<body>
<div class="instagram-container">
  <div class="instagram-header">
    <h1><i class="bi bi-eye"></i> Crowd View</h1>
  </div>

  <div class="instagram-feed">
    <div class="instagram-post">
      <div class="post-header">
        <div class="user-info">
          <div class="avatar">H</div>
          <div class="user-details">
            <span class="username">Hawker Centre</span>
            <span class="location">Crowd Levels</span>
          </div>
        </div>
      </div>
      
      <div class="post-image">
        <img src="https://upload.wikimedia.org/wikipedia/commons/6/63/Maxwell_Food_Centre%2C_Singapore_-_panoramio.jpg" 
             alt="Hawker Centre" style="width: 100%; height: 300px; object-fit: cover;" />
      </div>
      
      <div class="post-caption">
        <div class="dropdown" style="margin: 15px 0;">
        <label for="hawker-select">Select Hawker Centre:</label>
        <select id="hawker-select">
            <option value="maxwell" selected>Maxwell Food Centre</option>
            <option value="newton">Newton Food Centre</option>
            <option value="changi">Changi Village Food Centre</option>
        </select>
        </div>

        <div class="dropdown" style="margin: 15px 0;">
        <label for="stall-select">Select Stall:</label>
        <select id="stall-select">
            <option value="all">All Stalls</option>
            <option value="tian_tian">Tian Tian Hainanese Chicken Rice</option>
            <option value="zhen_zhen">Zhen Zhen Porridge</option>
            <option value="maxwell_fuzhou">Maxwell Fuzhou Oyster Cake</option>
        </select>
        </div>
        
        <div class="hawker-info-box">
          <div style="margin-bottom: 8px;">
            <strong>üìç <span id="hawker-name">Maxwell Food Centre</span></strong>
          </div>
          <div style="margin-bottom: 8px;">
            <span id="hawker-address">1 Kadayanallur St, Singapore 069184</span>
          </div>
          <div>
            <span id="hawker-hours">6:00AM - 10:00PM</span>
          </div>
        </div>
        
        <div style="height: 300px; margin: 15px 0;">
          <canvas id="crowdChart"></canvas>
        </div>
      </div>
    </div>
  </div>
</div>

<div class="nav-bar">
  <a href="/" class="nav-logo"><i class="bi bi-shop"></i>ChopeLah</a>
  <div class="nav-items">
    <button onclick="location.href='/pages/order/online-order-home.html'">
      <i class="bi bi-cart3"></i>
      <span>Order</span>
    </button>
    <button onclick="location.href='/pages/community/community.html'">
      <i class="bi bi-people"></i>
      <span>Community</span>
    </button>
    <button onclick="location.href='/pages/chope/chope.html'">
      <i class="bi bi-bookmark"></i>
      <span>Chope</span>
    </button>
    <button class="active">
      <i class="bi bi-eye"></i>
      <span>Crowd View</span>
    </button>
  </div>
  <div class="nav-right">
    <button class="notification-btn" onclick="alert('No new notifications')">
      <i class="bi bi-bell"></i>
      <span class="notification-badge">3</span>
    </button>
    <button onclick="location.href='/pages/profile/profile.html'">
      <i class="bi bi-person"></i>
      <span>Profile</span>
    </button>
  </div>
</div>

  <script>
    const hawkerData = {
      maxwell: {
        name: "Maxwell Food Centre",
        address: "1 Kadayanallur St, Singapore 069184",
        hours: "6:00AM - 10:00PM",
        stalls: {
          "peanuts-soup": [3, 8, 15, 25, 20, 18, 10, 2], // Peanuts Soup
          "hajmeer-kwaja": [2, 6, 12, 22, 18, 15, 8, 1], // Hajmeer Kwaja
          "luckmeow": [5, 12, 20, 35, 28, 30, 15, 3], // LuckMeow
          "ramen-taisho": [4, 10, 18, 30, 25, 28, 12, 2], // Ramen Taisho
          "china-street-fritters": [3, 8, 15, 28, 22, 20, 10, 2], // China Street Fritters
          "bold-x-braised": [4, 9, 16, 32, 26, 25, 12, 2], // Bold X Braised
          "korean-cuisine": [5, 11, 19, 35, 28, 32, 15, 3], // Korean Cuisine
          "neapolitan-style-pizza": [6, 12, 22, 40, 32, 35, 18, 4], // Neapolitan Style Pizza
          "tian-tian-chicken-rice": [8, 20, 35, 55, 45, 50, 25, 5] // Tian Tian Chicken Rice
        }
      },
      newton: {
        name: "Newton Food Centre",
        address: "500 Clemenceau Ave N, Singapore 229495",
        hours: "5:00AM - 11:00PM",
        stalls: {
          "hotplate-bbq-seafood": [6, 15, 28, 50, 40, 45, 22, 4], // Hotplate BBQ Seafood
          "22-best-satay": [8, 18, 32, 55, 45, 50, 25, 5], // 22 Best Satay
          "heng-heng-chicken-rice": [5, 12, 22, 40, 32, 35, 18, 3], // Heng Heng Chicken Rice
          "teochew-rice-and-porridge": [4, 10, 18, 35, 28, 30, 15, 2], // Teochew Rice And Porridge
          "lina-fishball-noodles": [3, 8, 15, 28, 22, 25, 12, 2], // Lina Fishball Noodles
          "aminahs-prata": [5, 12, 20, 38, 30, 32, 16, 3] // Aminah's Prata
        }
      },
      changi: {
        name: "Changi Village Food Centre",
        address: "2 Changi Village Rd, Singapore 500002",
        hours: "6:30AM - 9:00PM",
        stalls: {
          "d-authentic-nasi-lemak": [4, 12, 25, 45, 35, 40, 20, 3], // D Authentic Nasi Lemak
          "alliance-seafood": [6, 15, 28, 50, 40, 45, 22, 4], // Alliance Seafood
          "burgs": [4, 10, 18, 32, 26, 28, 14, 2], // Burgs
          "koka-wanton-noodles": [3, 8, 15, 28, 22, 25, 12, 2], // Koka Wanton Noodles
          "jiak-mee": [3, 8, 15, 28, 22, 25, 12, 2], // Jiak Mee
          "fortune-popiah": [2, 5, 10, 20, 15, 18, 8, 1], // Fortune Popiah
          "alifs-nasi-lemak": [4, 10, 20, 35, 28, 30, 15, 2], // Alif's Nasi Lemak
          "mala-hotpot": [5, 12, 22, 40, 32, 35, 18, 3] // Mala Hotpot
        }
      }
    };

    let currentHawker = 'maxwell';
    let currentStallData = hawkerData[currentHawker].stalls;

    function computeAllStallsSum() {
      const keys = Object.keys(currentStallData);
      const length = currentStallData[keys[0]].length;
      const totals = new Array(length).fill(0);
      keys.forEach(key => {
        currentStallData[key].forEach((value, idx) => {
          totals[idx] += value;
        });
      });
      return totals;
    }

    function updateHawkerInfo(hawkerKey) {
      const hawker = hawkerData[hawkerKey];
      document.getElementById('hawker-name').textContent = hawker.name;
      document.getElementById('hawker-address').textContent = hawker.address;
      document.getElementById('hawker-hours').textContent = "Loading hours...";
      
      // Fetch real hours from Google Maps via SerpAPI
      fetchHawkerHours(hawker.name, hawker.address);
    }

    function fetchHawkerHours(hawkerName, address) {
      // For now, use realistic static hours since API calls are problematic
      const staticHours = {
        maxwell: "6:00AM - 10:00PM (Daily)",
        newton: "5:00AM - 11:00PM (Daily)", 
        changi: "6:30AM - 9:00PM (Daily)"
      };
      
      const currentHawker = document.getElementById('hawker-select').value;
      document.getElementById('hawker-hours').textContent = staticHours[currentHawker] || "Hours not available";
      
      // Optional: Try API call in background (commented out due to CORS issues)
      /*
      const apiKey = "2e5022fe16c5374fb40750a1bb17db9b7884b94272d88de37b23b488abc363ff";
      const query = `${hawkerName} ${address}`;
      const url = `https://serpapi.com/search.json?engine=google_maps&q=${encodeURIComponent(query)}&location=Singapore&api_key=${apiKey}`;
      
      fetch(url)
        .then(response => response.json())
        .then(data => {
          console.log('API Response:', data);
          // Process API response here if needed
        })
        .catch(error => {
          console.log('API call failed, using static hours:', error);
        });
      */
    }

    function updateStallOptions(hawkerKey) {
      const stallSelect = document.getElementById('stall-select');
      const hawker = hawkerData[hawkerKey];
      
      // Clear existing options except "All Stalls"
      stallSelect.innerHTML = '<option value="all">All Stalls</option>';
      
      // Add hawker-specific stalls
      const stallNames = {
        maxwell: {
          "peanuts-soup": "Peanuts Soup",
          "hajmeer-kwaja": "Hajmeer Kwaja",
          "luckmeow": "LuckMeow",
          "ramen-taisho": "Ramen Taisho",
          "china-street-fritters": "China Street Fritters",
          "bold-x-braised": "Bold X Braised",
          "korean-cuisine": "Korean Cuisine",
          "neapolitan-style-pizza": "Neapolitan Style Pizza",
          "tian-tian-chicken-rice": "Tian Tian Chicken Rice"
        },
        newton: {
          "hotplate-bbq-seafood": "Hotplate BBQ Seafood",
          "22-best-satay": "22 Best Satay",
          "heng-heng-chicken-rice": "Heng Heng Chicken Rice",
          "teochew-rice-and-porridge": "Teochew Rice And Porridge",
          "lina-fishball-noodles": "Lina Fishball Noodles",
          "aminahs-prata": "Aminah's Prata"
        },
        changi: {
          "d-authentic-nasi-lemak": "D Authentic Nasi Lemak",
          "alliance-seafood": "Alliance Seafood",
          "burgs": "Burgs",
          "koka-wanton-noodles": "Koka Wanton Noodles",
          "jiak-mee": "Jiak Mee",
          "fortune-popiah": "Fortune Popiah",
          "alifs-nasi-lemak": "Alif's Nasi Lemak",
          "mala-hotpot": "Mala Hotpot"
        }
      };
      
      const currentStallNames = stallNames[hawkerKey];
      Object.keys(currentStallNames).forEach(stallKey => {
        const option = document.createElement('option');
        option.value = stallKey;
        option.textContent = currentStallNames[stallKey];
        stallSelect.appendChild(option);
      });
    }

    function fetchStallHours(hawkerName, stallName) {
      // Realistic stall hours based on typical hawker stall operating patterns
      const stallHours = {
        // Maxwell Food Centre stalls
        "peanuts-soup": "6:00AM - 2:00PM (Daily)",
        "hajmeer-kwaja": "5:30AM - 2:00PM (Daily)",
        "luckmeow": "7:00AM - 3:00PM (Daily)",
        "ramen-taisho": "11:00AM - 9:00PM (Daily)",
        "china-street-fritters": "6:00AM - 2:00PM (Daily)",
        "bold-x-braised": "11:00AM - 8:00PM (Daily)",
        "korean-cuisine": "11:00AM - 9:00PM (Daily)",
        "neapolitan-style-pizza": "12:00PM - 10:00PM (Daily)",
        "tian-tian-chicken-rice": "7:00AM - 2:00PM (Closed Mon)",
        
        // Newton Food Centre stalls  
        "hotplate-bbq-seafood": "5:00PM - 11:00PM (Daily)",
        "22-best-satay": "5:00PM - 11:00PM (Daily)",
        "heng-heng-chicken-rice": "10:00AM - 8:00PM (Daily)",
        "teochew-rice-and-porridge": "6:00AM - 2:00PM (Daily)",
        "lina-fishball-noodles": "7:00AM - 3:00PM (Daily)",
        "aminahs-prata": "7:00AM - 10:00PM (Daily)",
        
        // Changi Village Food Centre stalls
        "d-authentic-nasi-lemak": "6:00AM - 2:00PM (Daily)",
        "alliance-seafood": "5:00PM - 11:00PM (Daily)",
        "burgs": "11:00AM - 9:00PM (Daily)",
        "koka-wanton-noodles": "7:00AM - 3:00PM (Daily)",
        "jiak-mee": "7:00AM - 3:00PM (Daily)",
        "fortune-popiah": "6:00AM - 2:00PM (Daily)",
        "alifs-nasi-lemak": "6:00AM - 2:00PM (Daily)",
        "mala-hotpot": "11:00AM - 9:00PM (Daily)"
      };
      
      // Find the stall key based on stall name (reverse lookup)
      const stallKey = Object.keys(stallHours).find(key => {
        const stallNames = {
          "peanuts-soup": "Peanuts Soup",
          "hajmeer-kwaja": "Hajmeer Kwaja",
          "luckmeow": "LuckMeow",
          "ramen-taisho": "Ramen Taisho",
          "china-street-fritters": "China Street Fritters",
          "bold-x-braised": "Bold X Braised",
          "korean-cuisine": "Korean Cuisine",
          "neapolitan-style-pizza": "Neapolitan Style Pizza",
          "tian-tian-chicken-rice": "Tian Tian Chicken Rice",
          "hotplate-bbq-seafood": "Hotplate BBQ Seafood",
          "22-best-satay": "22 Best Satay",
          "heng-heng-chicken-rice": "Heng Heng Chicken Rice",
          "teochew-rice-and-porridge": "Teochew Rice And Porridge",
          "lina-fishball-noodles": "Lina Fishball Noodles",
          "aminahs-prata": "Aminah's Prata",
          "d-authentic-nasi-lemak": "D Authentic Nasi Lemak",
          "alliance-seafood": "Alliance Seafood",
          "burgs": "Burgs",
          "koka-wanton-noodles": "Koka Wanton Noodles",
          "jiak-mee": "Jiak Mee",
          "fortune-popiah": "Fortune Popiah",
          "alifs-nasi-lemak": "Alif's Nasi Lemak",
          "mala-hotpot": "Mala Hotpot"
        };
        return stallNames[key] === stallName;
      });
      
      const hours = stallKey ? stallHours[stallKey] : "Hours not available";
      document.getElementById('hawker-hours').innerHTML = `<strong>Stall Hours:</strong> ${hours}`;
    }

    // Initialize stall options on page load
    updateStallOptions(currentHawker);

    const ctx = document.getElementById("crowdChart");
    const chart = new Chart(ctx, {
      type: "bar",
      data: {
        labels: ["3a", "6a", "9a", "12p", "3p", "6p", "9p", "12a"],
        datasets: [
          {
            label: "Crowd Level",
            data: computeAllStallsSum(),
            backgroundColor: "#C9784F",
            borderRadius: 6,
          },
        ],
      },
      options: {
        responsive: true,
        maintainAspectRatio: false,
        plugins: { legend: { display: false } },
        scales: {
          y: {
            beginAtZero: true,
            grid: { color: "#F2D9BB" },
            ticks: { color: "#262626" },
          },
          x: {
            grid: { display: false },
            ticks: { color: "#262626" },
          },
        },
      },
    });

    // Update chart when hawker is changed
    const hawkerSelect = document.getElementById("hawker-select");
    hawkerSelect.addEventListener("change", (e) => {
      currentHawker = e.target.value;
      currentStallData = hawkerData[currentHawker].stalls;
      updateHawkerInfo(currentHawker);
      updateStallOptions(currentHawker);
      
      // Update chart with new hawker data (default to "All Stalls")
      chart.data.datasets[0].data = computeAllStallsSum();
      chart.update();
    });

    // Update chart when stall is changed
    const stallSelect = document.getElementById("stall-select");
    stallSelect.addEventListener("change", (e) => {
      const value = e.target.value;
      chart.data.datasets[0].data = value === 'all' ? computeAllStallsSum() : currentStallData[value];
      chart.update();
      
      // Fetch stall-specific hours if not "All Stalls"
      if (value !== 'all') {
        const hawker = hawkerData[currentHawker];
        const stallNames = {
          maxwell: {
            "peanuts-soup": "Peanuts Soup",
            "hajmeer-kwaja": "Hajmeer Kwaja",
            "luckmeow": "LuckMeow",
            "ramen-taisho": "Ramen Taisho",
            "china-street-fritters": "China Street Fritters",
            "bold-x-braised": "Bold X Braised",
            "korean-cuisine": "Korean Cuisine",
            "neapolitan-style-pizza": "Neapolitan Style Pizza",
            "tian-tian-chicken-rice": "Tian Tian Chicken Rice"
          },
          newton: {
            "hotplate-bbq-seafood": "Hotplate BBQ Seafood",
            "22-best-satay": "22 Best Satay",
            "heng-heng-chicken-rice": "Heng Heng Chicken Rice",
            "teochew-rice-and-porridge": "Teochew Rice And Porridge",
            "lina-fishball-noodles": "Lina Fishball Noodles",
            "aminahs-prata": "Aminah's Prata"
          },
          changi: {
            "d-authentic-nasi-lemak": "D Authentic Nasi Lemak",
            "alliance-seafood": "Alliance Seafood",
            "burgs": "Burgs",
            "koka-wanton-noodles": "Koka Wanton Noodles",
            "jiak-mee": "Jiak Mee",
            "fortune-popiah": "Fortune Popiah",
            "alifs-nasi-lemak": "Alif's Nasi Lemak",
            "mala-hotpot": "Mala Hotpot"
          }
        };
        
        const stallName = stallNames[currentHawker][value];
        if (stallName) {
          fetchStallHours(hawker.name, stallName);
        }
      } else {
        // Show hawker centre hours for "All Stalls"
        fetchHawkerHours(hawkerData[currentHawker].name, hawkerData[currentHawker].address);
      }
    });
  </script>
</body>
</html>



