<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Stall Details</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" />
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.css" rel="stylesheet" />
  <link rel="stylesheet" href="../style-1.css" />
  <link rel="stylesheet" href="../theme.css">
  <script type="module" src="../firebaseauth.js"></script>
  <style>
    .stall-card {
      background: #fff;
      border: 1px solid rgba(38,38,38,0.12);
      border-radius: 10px;
      box-shadow: 0 1px 6px rgba(38,38,38,0.06);
      padding: 1.25rem 1rem 1rem 1rem;
      max-width: 480px;
      margin: 0 auto;
    }
    #stallImg {
      width: 140px; height: 140px; object-fit: cover; border-radius: 10px;
      border: 1px solid var(--clr-cloud);
      box-shadow: 0 1px 4px rgba(38,38,38,0.05);
    }
    .btn.active {
      background-color: var(--clr-clay) !important;
      border-color: var(--clr-clay) !important;
      color: #fff !important;
    }
    .subtle-label { font-size: 12px; color: #666; }
    @media (max-width: 575px) {
      .stall-card { padding: 1rem 0.75rem; max-width: 100%; }
      #stallImg { width: 110px; height: 110px; }
    }
  </style>
</head>
<body>
  <div class="container my-4 tight">
    <div class="stall-card">
      <h3 class="text-center mb-0" id="stallName">Stall</h3>
      <div class="text-center subtle-label mb-2">Maxwell Food Centre</div>
      <div class="text-center mb-2">
        <img id="stallImg" src="" alt="Stall image" />
      </div>

      <div class="d-flex w-100 mb-3">
        <button class="btn btn-outline-primary flex-fill me-1" id="dineBtn">Dine In</button>
        <button class="btn btn-outline-primary flex-fill ms-1" id="pickupBtn">Pick Up</button>
      </div>

      <div class="mb-2 d-flex justify-content-between align-items-center">
        <span>Date selected:</span>
        <b id="dateToday"></b>
      </div>

      <div class="mb-3">
        <label class="form-label">Select a desired time:</label>
        <select id="time" class="form-select"></select>
      </div>

      <button id="continueBtn" class="btn btn-success w-100" disabled>Continue</button>
    </div>
  </div>

  <script>
    const stalls = [
      { name: "Peanuts Soup", cuisine: "Chinese", status: "Open", priceRange: "$5-10", rating: 4.3, waitTime: "10 min", img: "../img/stall1.jpg" },
      { name: "Hajmeer Kwaja Muslim Food", cuisine: "Malay", status: "Closed", priceRange: "$3-10", rating: 4.8, waitTime: "N/A", img: "../img/stall2.jpg" },
      { name: "LuckMeow", cuisine: "Indian", status: "Open", priceRange: "$2-10", rating: 4.1, waitTime: "15 min", img: "../img/stall3.jpg" },
      { name: "Ramen Taisho", cuisine: "Japanese", status: "Open", priceRange: "$7-15", rating: 4.2, waitTime: "8 min", img: "../img/stall4.jpg" },
      { name: "China Street Fritters", cuisine: "Chinese", status: "Open", priceRange: "$2-8", rating: 4.5, waitTime: "12 min", img: "../img/stall5.jpg" },
      { name: "Bold X Braised", cuisine: "Taiwanese", status: "Closed", priceRange: "$6-16", rating: 4.0, waitTime: "N/A", img: "../img/stall6.jpg" }
    ];

    const urlParams = new URLSearchParams(window.location.search);
    const stallIdx = urlParams.get("index") || 0;
    let stall = stalls[stallIdx];

    function renderStallCard(s){
      document.getElementById("stallName").textContent = s.name;
      document.getElementById("stallImg").src = s.img || '';
    }
    renderStallCard(stall);

    // Removed API enhancement

    function formatToday() {
      const d = new Date();
      const months = ["January","February","March","April","May","June","July","August","September","October","November","December"];
      return `${d.getDate()} ${months[d.getMonth()]} ${d.getFullYear()} (Today)`;
    }
    document.getElementById("dateToday").textContent = formatToday();

    let option = "Dine In";
    document.getElementById("dineBtn").classList.add("active");
    document.getElementById("continueBtn").disabled = true;

    function updateContinueButtonState() {
      const time = document.getElementById("time").value;
      document.getElementById("continueBtn").disabled = !(option && time);
    }

    document.getElementById("dineBtn").onclick = function () {
      option = "Dine In";
      this.classList.add("active");
      document.getElementById("pickupBtn").classList.remove("active");
      updateContinueButtonState();
    };
    document.getElementById("pickupBtn").onclick = function () {
      option = "Pick Up";
      this.classList.add("active");
      document.getElementById("dineBtn").classList.remove("active");
      updateContinueButtonState();
    };

    document.getElementById("time").addEventListener("change", updateContinueButtonState);

    function generateFutureTimeSlots(intervalMins = 15, count = 8) {
      const now = new Date();
      let minutes = now.getMinutes();
      let nextMinutes = (Math.floor(minutes / intervalMins) + 1) * intervalMins;
      if (nextMinutes >= 60) {
        now.setHours(now.getHours() + 1);
        nextMinutes = 0;
      }
      now.setMinutes(nextMinutes, 0, 0);

      const slots = ["ASAP"];
      for (let i = 0; i < count; i++) {
        let h = now.getHours();
        let m = now.getMinutes();
        let ampm = h >= 12 ? "PM" : "AM";
        let displayH = h % 12 || 12;
        slots.push(`${displayH}:${String(m).padStart(2, "0")}${ampm}`);
        now.setMinutes(now.getMinutes() + intervalMins);
      }
      return slots;
    }

    function fillTimeDropdown() {
      const slotOptions = generateFutureTimeSlots();
      const sel = document.getElementById("time");
      sel.innerHTML = "";
      slotOptions.forEach(val => {
        const opt = document.createElement("option");
        opt.value = val;
        opt.textContent = val;
        sel.appendChild(opt);
      });
      updateContinueButtonState();
    }

    fillTimeDropdown();

    function selectOption(option, time) {
      // Persist user's choice and redirect back to the menu page.
      localStorage.setItem('selectedOption', option); // e.g. 'ASAP' or 'Dine In'
      localStorage.setItem('selectedTime', time || '');
      // Use stall.name and a sensible default for food centre
      localStorage.setItem('selectedFoodCentre', localStorage.getItem('selectedFoodCentre') || 'Maxwell Food Centre');
      localStorage.setItem('selectedStall', stall.name || 'Stall A');
      // Redirect back to the menu so the user can continue ordering
      window.location.href = "menu.html?stall=" + encodeURIComponent(stall.name || '');
    }
    
    document.getElementById("continueBtn").onclick = function () {
      const time = document.getElementById("time").value;
      selectOption(option, time);
    };
    
    // NOTE: cart helpers (add/remove/update) belong in menu pages where
    // foodsPerCategory and cart state are defined. Removed duplicate helpers
    // from this file to avoid ReferenceError at runtime.
  </script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/js/bootstrap.bundle.min.js"></script>

    <div class="nav-bar">
      <button class="active" onclick="location.href='../order/online-order-home.html'">
        <i class="bi bi-cart3"></i>
        <span>Order</span>
      </button>
      <button onclick="location.href='../community/community.html'">
        <i class="bi bi-people"></i>
        <span>Community</span>
      </button>
      <button onclick="location.href='../chope/chope-home.html'">
        <i class="bi bi-bookmark"></i>
        <span>Chope</span>
      </button>
      <button onclick="location.href='../crowd/crowd-view.html'">
        <i class="bi bi-eye"></i>
        <span>Crowd View</span>
      </button>
      <button onclick="location.href='../profile.html'">
        <i class="bi bi-person"></i>
        <span>Profile</span>
      </button>
    </div>
</body>
</html>
